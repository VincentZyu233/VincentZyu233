(tip box)
文档地址：https://docs.mai-mai.org/manual/deployment/mmc_deploy_linux

仓库地址：https://github.com/Mai-with-u/MaiBot
(tip box 结束)

(warning box 开始)
请注意：文档可能会过时，请记得随时 查看最新仓库，最新文档
请善用 搜索引擎，善用大模型。
用google，不要百度。
用stackoverflow 不要csdn
用wiki百科，不要百度百科。

chatgpt，gemini 网页版 都是免费使用的。这两个都是非常优秀的大模型
(warning box 结束)

(details box 默认折叠)
我的系统配置参考：
```shell
root@S43LYjdh3w4zO:~# neofetch
       _,met$$$$$gg.          root@S43LYjdh3w4zO
    ,g$$$$$$$$$$$$$$$P.       ------------------
  ,g$$P"     """Y$$.".        OS: Debian GNU/Linux 12 (bookworm) x86_64
 ,$$P'              `$$$.     Host: KVM RHEL 7.6.0 PC (i440FX + PIIX, 1996)
',$$P       ,ggs.     `$$b:   Kernel: 6.1.0-10-amd64
`d$$'     ,$P"'   .    $$$    Uptime: 4 mins
 $$P      d$'     ,    $$P    Packages: 501 (dpkg)
 $$:      $$.   -    ,d$$'    Shell: bash 5.2.15
 $$;      Y$b._   _,d$P'      Resolution: 1024x768
 Y$$.    `.`"Y$$$$P"'         Terminal: /dev/pts/0
 `$$b      "-.__              CPU: Intel Xeon E5-2686 v4 (1) @ 2.294GHz
  `Y$$                        GPU: 00:02.0 Cirrus Logic GD 5446
   `Y$$.                      Memory: 103MiB / 1919MiB
     `$$b.
       `Y$$b.
          `"Y$b._
              `"""
```
(details box 结束。默认折叠)



部分指令需要sudo权限，如果有提示permission denied等信息，可以切换root 或者用sudo

```shell
# 先换源，修改/etc/apt/sources.list文件
# 可以参考： G:\GGames\Minecraft\shuyeyun\qq-bot\AAA_from_git_AAA\VincentZyu233\docs\notes\switch-source\debian.md
#（文档网页里面是放超链接）

apt update
# 可以先安装一些基本的常用的软件包捏
apt install tree htop btop nload neofetch curl wget git proxychains4 proxychains tmux screen net-tools
# 在一些更新的发行版里面，neofetch用不了捏，可以换成fastfetch


# 然后安装uv
curl -LsSf https://astral.sh/uv/install.sh | sh
# 如果访问不了可以
# 1. 购买境外的vps，比如 hk jp us sg 等等
# 2. 配置命令行代理，proxychains或者环境变量， 可以参考：G:\GGames\Minecraft\shuyeyun\qq-bot\AAA_from_git_AAA\VincentZyu233\docs\notes\shell-proxy\proxychains.md or 
# 3. 适用国内镜像源安装uv，比如 https://gitee.com/wangnov/uv-custom/releases
curl -LsSf https://gitee.com/wangnov/uv-custom/releases/download/0.9.16/uv-installer-custom.sh | sh
# 这个好，他还自动给你配置镜像源的
安装完成以后会这样输出：
root@S43LYjdh3w4zO:/data/maibot# curl -LsSf https://gitee.com/wangnov/uv-custom/releases/download/0.9.16/uv-installer-custom.sh | sh
downloading uv 0.9.16 x86_64-unknown-linux-gnu
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
正在配置默认的 PyPI 和 Python 下载镜像...
✅ 配置完成。镜像设置如下:
   - Python 下载代理: https://ghfast.top
   - PyPI 镜像源: https://pypi.tuna.tsinghua.edu.cn/simple
   - uv 版本: 0.9.16
   - 配置文件路径: /root/.config/uv/uv.toml
root@S43LYjdh3w4zO:/data/maibot#

# 看看uv的toml配置文件捏：
root@S43LYjdh3w4zO:/data/maibot# cat /root/.config/uv/uv.toml
python-install-mirror = "https://ghfast.top/https://github.com/astral-sh/python-build-standalone/releases/download"

[[index]]
url = "https://pypi.tuna.tsinghua.edu.cn/simple"
default = true
root@S43LYjdh3w4zO:/data/maibot#
# 666还真自动配了，这个好o(￣▽￣)ｄ

# 确认uv版本和路径：
uv --version
which uv
# 这样就说明成了：
root@S43LYjdh3w4zO:/data/maibot# uv --version
uv 0.9.16
root@S43LYjdh3w4zO:/data/maibot# which uv
/root/.local/bin/uv
root@S43LYjdh3w4zO:/data/maibot#

# 找一个地方clone 麦麦的仓库， 比如：
mkdir -p /data/maibot
cd /data/maibot
pwd # ensure current path
git clone https://github.com/MaiM-with-u/MaiBot.git
git clone https://github.com/MaiM-with-u/MaiBot-Napcat-Adapter.git

# 同样的，如果clone失败，可以配置代理
# 或者使用国内镜像：
git clone https://gitee.com/DrSmooth/MaiBot
git clone https://gitee.com/yhArcadia/MaiBot-Napcat-Adapter
# 如果失效，那么你可以去google搜索：gitee Maibot / gitee MaiBot-Napcat-Adapter 这种关键词，看别人有没有搞仓库镜像(

# 当然 你自己去github仓库，下载zip解压，也能用，
# 区别就是， git clone下来的仓库 会在根目录多一个.git文件夹，这个文件夹用来做版本控制的
# 如果你后续不用git pull更新的话，其实这样做也没有区别hhh

# tipbox，默认折叠
# 可以用ls和tree简单确认一下目录结构， 比如：
# 先把目录结构眼熟一下，肯定是没坏处的(
root@S43LYjdh3w4zO:/data/maibot# ls
MaiBot  MaiBot-Napcat-Adapter

apt install tree

root@S43LYjdh3w4zO:/data/maibot# tree -L 3
.
├── MaiBot
│   ├── bot.py
│   ├── changelogs
│   │   ├── changelog.md
│   │   └── changes.md
│   ├── CODE_OF_CONDUCT.md
│   ├── depends-data
│   │   ├── char_frequency.json
│   │   ├── maimai.png
│   │   └── video.png
│   ├── docker-compose.yml
│   ├── Dockerfile
│   ├── docs-src
│   │   ├── Bing.md
│   │   ├── CONTRIBUTE.md
│   │   └── plugins
│   ├── EULA.md
│   ├── LICENSE
│   ├── log_viewer
│   │   └── log_viewer_optimized.py
│   ├── plugins
│   │   ├── ChatFrequency
│   │   ├── emoji_manage_plugin
│   │   ├── hello_world_plugin
│   │   └── __init__.py
│   ├── PRIVACY.md
│   ├── pyproject.toml
│   ├── README.md
│   ├── requirements.txt
│   ├── scripts
│   │   ├── build_io_pairs.py
│   │   ├── expression_scatter_analysis.py
│   │   ├── expression_stats.py
│   │   ├── import_openie.py
│   │   ├── info_extraction.py
│   │   ├── mmipkg_tool.py
│   │   ├── raw_data_preprocessor.py
│   │   ├── run_lpmm.sh
│   │   └── run.sh
│   ├── src
│   │   ├── chat
│   │   ├── common
│   │   ├── config
│   │   ├── express
│   │   ├── hippo_memorizer
│   │   ├── __init__.py
│   │   ├── jargon
│   │   ├── llm_models
│   │   ├── main.py
│   │   ├── manager
│   │   ├── memory_system
│   │   ├── mood
│   │   ├── person_info
│   │   ├── plugins
│   │   ├── plugin_system
│   │   └── webui
│   ├── template
│   │   ├── bot_config_template.toml
│   │   ├── model_config_template.toml
│   │   └── template.env
│   ├── test_edge.py
│   └── webui
│       └── dist
└── MaiBot-Napcat-Adapter
    ├── command_args.md
    ├── Dockerfile
    ├── LICENSE
    ├── main.py
    ├── notify_args.md
    ├── pyproject.toml
    ├── README.md
    ├── requirements.txt
    ├── src
    │   ├── config
    │   ├── database.py
    │   ├── __init__.py
    │   ├── logger.py
    │   ├── mmc_com_layer.py
    │   ├── recv_handler
    │   ├── response_pool.py
    │   ├── send_handler
    │   └── utils.py
    └── template
        └── template_config.toml

36 directories, 49 files
root@S43LYjdh3w4zO:/data/maibot#

（tip box 结束）

# 接下来配venv，装依赖
# 先cd进去
cd MaiBot
# 用uv创建虚拟环境
uv venv
# 装依赖
# 你可以用环境变量临时指定镜像源：
export UV_DEFAULT_INDEX="https://pypi.tuna.tsinghua.edu.cn/simple"
uv pip install -r requirements.txt --upgrade
# 当然也可以用pip的-i参数
uv pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --upgrade
```

（infobox， 默认折叠）实操看看：
实操看看：root@S43LYjdh3w4zO:/data/maibot/MaiBot# uv venv
Using CPython 3.11.2 interpreter at: /usr/bin/python3
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
root@S43LYjdh3w4zO:/data/maibot/MaiBot# uv pip install -r requirements.txt --upgrade
⠇ jieba==0.42.1                                                                                                                     ^C
root@S43LYjdh3w4zO:/data/maibot/MaiBot# ^C
root@S43LYjdh3w4zO:/data/maibot/MaiBot# ^C
root@S43LYjdh3w4zO:/data/maibot/MaiBot# uv pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --upgrade
Resolved 80 packages in 10.35s
      Built peewee==3.18.3
   Building jieba==0.42.1
   Building jieba==0.42.1
  × Failed to build `quick-algo==0.1.3`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta.build_wheel` failed (exit status: 1)

      [stdout]
      Enabled AVX2 support
      running bdist_wheel
      running build
      running build_py
      creating build/lib.linux-x86_64-cpython-311/quick_algo
      copying src/quick_algo/__init__.py -> build/lib.linux-x86_64-cpython-311/quick_algo
      running egg_info
      writing src/quick_algo.egg-info/PKG-INFO
      writing dependency_links to src/quick_algo.egg-info/dependency_links.txt
      writing requirements to src/quick_algo.egg-info/requires.txt
      writing top-level names to src/quick_algo.egg-info/top_level.txt
      reading manifest file 'src/quick_algo.egg-info/SOURCES.txt'
      reading manifest template 'MANIFEST.in'
      adding license file 'LICENSE.txt'
      writing manifest file 'src/quick_algo.egg-info/SOURCES.txt'
      copying src/quick_algo/di_graph.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo
      copying src/quick_algo/di_graph.pyi -> build/lib.linux-x86_64-cpython-311/quick_algo
      copying src/quick_algo/pagerank.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo
      copying src/quick_algo/pagerank.pyi -> build/lib.linux-x86_64-cpython-311/quick_algo
      creating build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/back_propagation.hpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/back_propagation_impl.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/back_propagation_impl_test.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/di_graph.hpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/di_graph_impl.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/pagerank.hpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/pagerank_impl.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      copying src/quick_algo/cpp/pagerank_impl_test.cpp -> build/lib.linux-x86_64-cpython-311/quick_algo/cpp
      running build_ext
      building 'quick_algo.di_graph' extension
      creating build/temp.linux-x86_64-cpython-311/src/quick_algo/cpp
      x86_64-linux-gnu-g++ -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat
      -Werror=format-security -g -fwrapv -O2 -fPIC -Isrc/quick_algo -I/root/.cache/uv/builds-v0/.tmpS14xcM/include
      -I/usr/include/python3.11 -c src/quick_algo/cpp/di_graph_impl.cpp -o
      build/temp.linux-x86_64-cpython-311/src/quick_algo/cpp/di_graph_impl.o -mavx2 -D__AVX2__

      [stderr]
      no previously-included directories found matching 'tests'
      /root/.cache/uv/builds-v0/.tmpS14xcM/lib/python3.11/site-packages/setuptools/command/build_py.py:212: _Warning: Package
      'quick_algo.cpp' is absent from the `packages` configuration.
      !!

              ********************************************************************************
              ############################
              # Package would be ignored #
              ############################
              Python recognizes 'quick_algo.cpp' as an importable package[^1],
              but it is absent from setuptools' `packages` configuration.

              This leads to an ambiguous overall configuration. If you want to distribute this
              package, please make sure that 'quick_algo.cpp' is explicitly added
              to the `packages` configuration field.

              Alternatively, you can also rely on setuptools' discovery methods
              (for example by using `find_namespace_packages(...)`/`find_namespace:`
              instead of `find_packages(...)`/`find:`).

              You can read more about "package discovery" on setuptools documentation page:

              - https://setuptools.pypa.io/en/latest/userguide/package_discovery.html

              If you don't want 'quick_algo.cpp' to be distributed and are
              already explicitly excluding 'quick_algo.cpp' via
              `find_namespace_packages(...)/find_namespace` or `find_packages(...)/find`,
              you can try to use `exclude_package_data`, or `include-package-data=False` in
              combination with a more fine grained `package-data` configuration.

              You can read more about "package data files" on setuptools documentation page:

              - https://setuptools.pypa.io/en/latest/userguide/datafiles.html


              [^1]: For Python, any directory (with suitable naming) can be imported,
                    even if it does not contain any `.py` files.
                    On the other hand, currently there is no concept of package data
                    directory, all directories are treated like packages.
              ********************************************************************************

      !!
        check.warn(importable)
      error: command 'x86_64-linux-gnu-g++' failed: No such file or directory

      hint: This usually indicates a problem with the package or the build environment.
root@S43LYjdh3w4zO:/data/maibot/MaiBot#

```shell

（info box 结束）

# 哦不，好像有点问题捏
# 好像有一个叫做quick-algo的库 需要native编译，
# 可以参考这里：
# https://docs.mai-mai.org/manual/configuration/lpmm

# 在我自己的机器是这样解决的哈：
apt update
apt install build-essential -y
# build-essential 会自动安装 gcc、g++、make、dpkg-dev 等软件包，提供完整的c/cpp编译环境。
apt install python3.11-dev -y 
# 安装Python 3.11 的开发头文件，因为debian12自带的py解释器是3.11.2

# 然后再次执行：
uv pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --upgrade

```


```shell
#回到上一级文件夹，再进入MaiBot-Napcat-Adapter文件夹，安装依赖

cd ..
cd MaiBot-Napcat-Adapter
uv venv
uv pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --upgrade


# 然后部署 MaiBot Napcat Adapter 部署 和 NapCat
# 在MaiBot-Napcat-Adapter文件夹中 
# 复制并重命名文件
cp template/template_config.toml config.toml

```

（detailsbox 默认折叠）

root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# cat config.toml
[inner]
version = "0.1.2" # 版本号
# 请勿修改版本号，除非你知道自己在做什么

[nickname] # 现在没用
nickname = ""

[napcat_server] # Napcat连接的ws服务设置
host = "localhost"      # Napcat设定的主机地址
port = 8095             # Napcat设定的端口
token = ""              # Napcat设定的访问令牌，若无则留空
heartbeat_interval = 30 # 与Napcat设置的心跳相同（按秒计）

[maibot_server] # 连接麦麦的ws服务设置
host = "localhost" # 麦麦在.env文件中设置的主机地址，即HOST字段
port = 8000        # 麦麦在.env文件中设置的端口，即PORT字段

[chat] # 黑白名单功能
group_list_type = "whitelist" # 群组名单类型，可选为：whitelist, blacklist
group_list = []               # 群组名单
# 当group_list_type为whitelist时，只有群组名单中的群组可以聊天
# 当group_list_type为blacklist时，群组名单中的任何群组无法聊天
private_list_type = "whitelist" # 私聊名单类型，可选为：whitelist, blacklist
private_list = []               # 私聊名单
# 当private_list_type为whitelist时，只有私聊名单中的用户可以聊天
# 当private_list_type为blacklist时，私聊名单中的任何用户无法聊天
ban_user_id = []   # 全局禁止名单（全局禁止名单中的用户无法进行任何聊天）
ban_qq_bot = false # 是否屏蔽QQ官方机器人
enable_poke = true # 是否启用戳一戳功能

[voice] # 发送语音设置
use_tts = false # 是否使用tts语音（请确保你配置了tts并有对应的adapter）

[debug]
level = "INFO" # 日志等级（DEBUG, INFO, WARNING, ERROR, CRITICAL）
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#

如果出现端口占用等情况，你可以修改配置，
你也可以增加token 增加安全性捏
我的配置:
[napcat_server] # Napcat连接的ws服务设置
host = "0.0.0.0"      # Napcat设定的主机地址
port = 58095             # Napcat设定的端口
token = "maimai"              # Napcat设定的访问令牌，若无则留空
heartbeat_interval = 30 # 与Napcat设置的心跳相同（按秒计）
(心跳间隔这个不要动)

默认是白名单模式哈，也就是 需要在群号列表 和 qq号列表里面 加内容，才会回复群消息/私聊消息捏
（detail box 结束）

```shell
# 然后先去跑napcat，可以参考:
# https://napneko.github.io/
# https://doc.napneko.icu/
# https://napcat.napneko.icu/
# https://napneko.pages.dev/
# https://napcat.cyou/
# https://www.napcat.wiki/
# https://deepwiki.com/NapNeko/NapCatQQ

# https://napneko.github.io/guide/boot/Shell#napcat-installer-linux-%E4%B8%80%E9%94%AE%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC-%E6%94%AF%E6%8C%81ubuntu-20-debian-10-centos9

# 推荐用docker部署：
# https://github.com/NapNeko/NapCat-Docker

# 可以使用docker官方脚本部署docker：
# https://docs.docker.com/engine/install/debian/
# 可以配一个proxychains bash，然后把里面的指令逐行执行就行了捏

# 或者用这个：
### 脚本一键安装docker

[linuxmirrors](https://linuxmirrors.cn)


bash <(curl -sSL https://linuxmirrors.cn/docker.sh)

```

detail box 开始
看看是不是装好了捏
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker --version
Docker version 29.1.2, build 890dcca
detail box 结束

```shell

# 参考docker run 命令：
docker run -d \
-e NAPCAT_GID=$(id -g) \
-e NAPCAT_UID=$(id -u) \
-p 3000:3000 \
-p 3001:3001 \
-p 6099:6099 \
--name napcat \
--restart=always \
mlikiowa/napcat-docker:latest

# dockerhub 大陆无法访问，可以尝试镜像源：
# https://1ms.run/
docker run -d \
-e NAPCAT_GID=$(id -g) \
-e NAPCAT_UID=$(id -u) \
-p 3000:3000 \
-p 3001:3001 \
-p 6099:6099 \
--name napcat \
--restart=always \
docker.1ms.run/mlikiowa/napcat-docker:latest
# 在最后的 容器名前面 加上 `docker.1ms.run/` 即可捏



```

details box 开始

看看容器状态：
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker ps -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker images
                                                                                                                i Info →   U  In Use
IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker run -d \
-e NAPCAT_GID=$(id -g) \
-e NAPCAT_UID=$(id -u) \
-p 3000:3000 \
-p 3001:3001 \
-p 6099:6099 \
--name napcat \
--restart=always \
docker.1ms.run/mlikiowa/napcat-docker:latest
Unable to find image 'docker.1ms.run/mlikiowa/napcat-docker:latest' locally
latest: Pulling from mlikiowa/napcat-docker
62fc43c2d415: Downloading [===>                                               ]  15.73MB/225.8MB
62fc43c2d415: Downloading [===================================>               ]  161.5MB/225.8MB
62fc43c2d415: Downloading [===================================>               ]  162.5MB/225.8MB
62fc43c2d415: Downloading [===================================>               ]  162.5MB/225.8MB
62fc43c2d415: Pull complete
490f82e472ca: Downloading [============================>                      ]  156.2MB/272MB
490f82e472ca: Pull complete
b33d1b13a08a: Pull complete
9165f06d8e89: Pull complete
cbd6950acf74: Pull complete

Digest: sha256:bb3f4e34f9b082f039bfdf83dc43cb3f29c66c3288c6da8dcc1748587082a804
Status: Downloaded newer image for docker.1ms.run/mlikiowa/napcat-docker:latest




e19a7430c8f05c1bf13404d868e43360343a44c7e5abc87da6ff2d972c4e0acd
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker ps -a
doCONTAINER ID   IMAGE                                          COMMAND                CREATED         STATUS         PORTS                                                      NAMES
e19a7430c8f0   docker.1ms.run/mlikiowa/napcat-docker:latest   "bash entrypoint.sh"   7 seconds ago   Up 5 seconds   0.0.0.0:3000-3001->3000-3001/tcp, 0.0.0.0:6099->6099/tcp   napcat
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker images
                                                                                                                                                                                      i Info →   U  In Use
IMAGE                                          ID             DISK USAGE   CONTENT SIZE   EXTRA
docker.1ms.run/mlikiowa/napcat-docker:latest   bb3f4e34f9b0       2.01GB          570MB    U
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#

details box 结束

确认napcat跑起来以后 接着就是去找token
你可以直接通过筛选日志 找token：
docker logs napcat | grep token
（你需要把这里的napcat 替换为 你实际的容器名）

(detail box 开始)
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# docker logs napcat | grep token
[34:1207/120337.676224:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
[34:1207/120339.098060:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
[34:1207/120339.100182:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
[34:1207/120339.109152:ERROR:bus.cc(407)] Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are "tcp" and on UNIX "unix")
[34:1207/120339.109543:ERROR:bus.cc(407)] Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are "tcp" and on UNIX "unix")
[34:1207/120339.109832:ERROR:bus.cc(407)] Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are "tcp" and on UNIX "unix")
[34:1207/120339.110115:ERROR:bus.cc(407)] Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are "tcp" and on UNIX "unix")
[34:1207/120339.110409:ERROR:object_proxy.cc(576)] Failed to call method: org.freedesktop.DBus.NameHasOwner: object_path= /org/freedesktop/DBus: unknown error type:
[66:1207/120340.323511:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[66:1207/120340.329808:ERROR:gl_context_egl.cc(159)] Failed to get config for surface (nil)
[66:1207/120340.332921:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[66:1207/120340.333226:ERROR:gl_surface_egl.cc(1014)] No suitable EGL configs found for initialization.
[66:1207/120340.333595:ERROR:gpu_info_collector.cc(84)] gl::GLContext::CreateOffscreenGLSurface failed
[66:1207/120340.333926:ERROR:gpu_info_collector.cc(592)] Could not create surface for info collection.
[66:1207/120340.335850:ERROR:gpu_init.cc(106)] CollectGraphicsInfo failed.
[66:1207/120340.356926:ERROR:viz_main_impl.cc(185)] Exiting GPU process due to errors during initialization
[83:1207/120341.685783:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[83:1207/120341.688860:ERROR:gl_context_egl.cc(159)] Failed to get config for surface (nil)
[83:1207/120341.689316:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[83:1207/120341.689585:ERROR:gl_surface_egl.cc(1014)] No suitable EGL configs found for initialization.
[83:1207/120341.689874:ERROR:gpu_info_collector.cc(84)] gl::GLContext::CreateOffscreenGLSurface failed
[83:1207/120341.690112:ERROR:gpu_info_collector.cc(592)] Could not create surface for info collection.
[83:1207/120341.690334:ERROR:gpu_init.cc(106)] CollectGraphicsInfo failed.
[83:1207/120341.703072:ERROR:viz_main_impl.cc(185)] Exiting GPU process due to errors during initialization
12-07 12:03:42 [info] [NapCat] [WebUi] WebUi User Panel Url: http://127.0.0.1:6099/webui?token=你的napcat的token
12-07 12:03:42 [info] [NapCat] [WebUi] WebUi User Panel Url: http://0.0.0.0:6099/webui?token=你的napcat的token
[106:1207/120342.804455:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[106:1207/120342.808462:ERROR:gl_context_egl.cc(159)] Failed to get config for surface (nil)
[106:1207/120342.809147:ERROR:gl_surface_egl.cc(303)] No suitable EGL configs found.
[106:1207/120342.809669:ERROR:gl_surface_egl.cc(1014)] No suitable EGL configs found for initialization.
[106:1207/120342.810056:ERROR:gpu_info_collector.cc(84)] gl::GLContext::CreateOffscreenGLSurface failed
[106:1207/120342.810424:ERROR:gpu_info_collector.cc(592)] Could not create surface for info collection.
[106:1207/120342.811504:ERROR:gpu_init.cc(106)] CollectGraphicsInfo failed.
[106:1207/120342.823544:ERROR:viz_main_impl.cc(185)] Exiting GPU process due to errors during initialization
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter#
（detail box 结束）

你也可以进入容器输出配置文件：
```shell
docker exec -it napcat bash
cat /app/napcat/config/webui.json | grep token
exit
```

然后打开napcat的webui，比如刚刚我设置了 -p 6099:6099

然后先把 MaiBot-Napcat-Adapter 跑起来
可以使用screen 或者 tmux 或者 nohup 或者 系统服务 或者 mcsm项目 等工具，进行保进程。
这里演示screen，其他的项目可以自行谷歌搜索/询问大语言模型
```shell
# cd到MaiBot-Napcat-Adapter的目录
cd  MaiBot-Napcat-Adapter
# 启动一个screen会话
screen -S MaiBot-Napcat-Adapter
# 使用uv启动bot
uv run python main.py
```

（detail box开始）
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# ls
1ms-helper       config.toml  Dockerfile  main.py         pyproject.toml  requirements.txt  template
command_args.md  data         LICENSE     notify_args.md  README.md       src               uv.lock
root@S43LYjdh3w4zO:/data/maibot/MaiBot-Napcat-Adapter# uv run python main.py
warning: No `requires-python` value found in the workspace. Defaulting to `>=3.11`.
2025-12-07 12:30:46.405 | INFO     | src.config.config:update_config:53 - 检测到配置文件版本号相同 (v0.1.2)，跳过更新
2025-12-07 12:30:46.405 | INFO     | src.config.config:<module>:144 - 正在品鉴配置文件...
2025-12-07 12:30:46.411 | INFO     | src.config.config:<module>:146 - 非常的新鲜，非常的美味！
2025-12-07 12:30:46 | INFO     | src:<module>:25 - 版本

MaiBot-Napcat-Adapter 版本: 0.5.5
喜欢的话点个star喵~

2025-12-07 12:30:47 | INFO     | src.database:_ensure_database:62 - 确保数据库文件和表已创建...
2025-12-07 12:30:47 | SUCCESS  | src.database:_ensure_database:64 - 数据库和表已创建或已存在
2025-12-07 12:30:48 | INFO     | __main__:napcat_server:67 - 正在启动adapter...
2025-12-07 12:30:48 | INFO     | src.mmc_com_layer:mmc_start_com:18 - 正在连接MaiBot
2025-12-07 12:30:48 | INFO     | src.response_pool:check_timeout_response:43 - 已删除 0 条超时响应消息
2025-12-07 12:30:48 | INFO     | maim_message.ws_connection:connect:478 - 正在连接到 ws://localhost:8000/ws
2025-12-07 12:30:48 | INFO     | __main__:napcat_server:69 - Adapter已启动，监听地址: ws://0.0.0.0:58095
2025-12-07 12:30:51 | INFO     | maim_message.router:_monitor_connections:79 - 检测到平台 qq 的连接已断开，正在尝试重新连接
2025-12-07 12:30:51 | INFO     | maim_message.ws_connection:stop:612 - 正在停止 WebSocket 客户端...
2025-12-07 12:30:51 | INFO     | maim_message.ws_connection:stop:637 - WebSocket 客户端已停止
2025-12-07 12:30:51 | INFO     | maim_message.ws_connection:connect:478 - 正在连接到 ws://localhost:8000/ws
2025-12-07 12:30:56 | INFO     | maim_message.router:_monitor_connections:79 - 检测到平台 qq 的连接已断开，正在尝试重新连接
2025-12-07 12:30:56 | INFO     | maim_message.ws_connection:stop:612 - 正在停止 WebSocket 客户端...
2025-12-07 12:30:56 | INFO     | maim_message.ws_connection:stop:637 - WebSocket 客户端已停止
2025-12-07 12:30:56 | INFO     | maim_message.
（detail box结束）

然后是寻找： 从docker容器里面访问宿主机的ip
因为：Maibot-Napcat-Adapter开了一个ws服务端，用来对接Napcat的ws客户端
在有些环境下 可以使用这个域名 ：host.docker.internal
如果不行的话，在命令行输入指令 ip a 查看网卡情况

你可以使用ai，即：把所有的ip a的输出发给大语言模型，
提示词示例：请问我应该用什么ip 从容器内访问宿主机？

(detail box 开始)

```shell
root@S43LYjdh3w4zO:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: ens17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether c8:25:b5:00:00:23 brd ff:ff:ff:ff:ff:ff
    altname enp0s17
    inet 172.16.0.34/12 brd 172.31.255.255 scope global ens17
       valid_lft forever preferred_lft forever
    inet6 fe80::ca25:b5ff:fe00:23/64 scope link
       valid_lft forever preferred_lft forever
3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default
    link/ether aa:42:f1:bc:ca:3e brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.1/20 brd 192.168.15.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::a842:f1ff:febc:ca3e/64 scope link
       valid_lft forever preferred_lft forever
8: vethe2e2d4b@if2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default
    link/ether 56:43:f2:d1:ff:cb brd ff:ff:ff:ff:ff:ff link-netnsid 2
    inet6 fe80::5443:f2ff:fed1:ffcb/64 scope link
       valid_lft forever preferred_lft forever
root@S43LYjdh3w4zO:~#
```
比如在我现在用的这个虚拟机上面， 这两个ip是可以的：
172.16.0.34 和 192.168.0.1


（detail box 结束）

所以，现在去Napcat网络配置，新建 WS客户端，
勾选启用，
名称随便填，我填写maimai方便提醒自己
url填写 ws://<宿主机ip>:<宿主机上的Maibot-Napcat-Adapter的ws服务器的端口>
token填写Maibot-Napcat-Adapter 的ws服务器的token

端口和token 在Maibot-Napcat-Adapter的config.toml配置文件里面能找到捏


(detail box 开始)

我的配置:
```toml
[napcat_server] # Napcat连接的ws服务设置
host = "0.0.0.0"      # Napcat设定的主机地址
port = 58095             # Napcat设定的端口
token = "maimai"              # Napcat设定的访问令牌，若无则留空
heartbeat_interval = 30 # 与Napcat设置的心跳相同（按秒计）
(心跳间隔这个不要动)
```
我的ip a输出：
```shell
root@S43LYjdh3w4zO:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: ens17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether c8:25:b5:00:00:23 brd ff:ff:ff:ff:ff:ff
    altname enp0s17
    inet 172.16.0.34/12 brd 172.31.255.255 scope global ens17
       valid_lft forever preferred_lft forever
    inet6 fe80::ca25:b5ff:fe00:23/64 scope link
       valid_lft forever preferred_lft forever
3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default
    link/ether aa:42:f1:bc:ca:3e brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.1/20 brd 192.168.15.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::a842:f1ff:febc:ca3e/64 scope link
       valid_lft forever preferred_lft forever
8: vethe2e2d4b@if2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default
    link/ether 56:43:f2:d1:ff:cb brd ff:ff:ff:ff:ff:ff link-netnsid 2
    inet6 fe80::5443:f2ff:fed1:ffcb/64 scope link
       valid_lft forever preferred_lft forever
root@S43LYjdh3w4zO:~#
```

所以我的url填写：
`ws://172.16.0.34:58095`
我的token填写：
`maimai`

心跳间隔默认的`30000ms`不改，重连间隔稍微短点没事，比如我写的是：`1111ms`


(detail box 结束)

然后去看napcat的日志（网页端的 webui 猫猫日志
http://<napcat的ip>:<napcat的端口>/webui/logs
```log
[ERROR] [OneBot] [WebSocket Client] 反向WebSocket (ws://172.16.0.34:58095) 连接意外关闭
[ERROR] [OneBot] [WebSocket Client] 在 1 秒后尝试重新连接
[INFO] [Notice] [OneBot11] 配置变更前:
[network] 配置加载
WebSocket反向服务: ws://172.16.0.34:58095, : 未启动

[INFO] [Notice] [OneBot11] 配置变更后:
[network] 配置加载
WebSocket反向服务: ws://172.16.0.34:58095, : 已启动
```

接着去启动MaiBot 插件框架本身，
```shell
# 先cd过去，比如：
cd /data/maibot/MaiBot

# 创建config文件夹
mkdir config
# 复制并重命名配置文件
cp template/bot_config_template.toml config/bot_config.toml
cp template/model_config_template.toml config/model_config.toml
cp template/template.env .env

# 用文本编辑器，修改这个配置文件
# 你也可以用其他工具，比如vim vi， mt管理器的ssh+文本编辑器， MobaXTerm的ssh+文本编辑器，FinalShell的ssh+文本编辑器
nano config/model_config.toml
# 用 上下左右按键 移动光标，用pageup pagedown 翻阅多行
# 往下翻，找到 这一部分：
```

```toml
[[api_providers]] # SiliconFlow的API服务商配置
name = "SiliconFlow"
base_url = "https://api.siliconflow.cn/v1"
api_key = "your-siliconflow-api-key"
client_type = "openai"
max_retry = 3
timeout = 120
retry_interval = 5
```

```shell
# 用Backspace退格键 删去默认的 your-siliconflow-api-key
# 去硅基官网 https://cloud.siliconflow.cn/me/account/ak 找到密钥
# 复制，然后粘贴 填入 api key的位置

# 开一个screen会话
screen -S MaiBot
# 用uv启动bot
uv run python3 bot.py
```

